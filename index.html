<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Life wgpu</title>
    <link rel="icon" type="image/png" href="./icon.png">
    <style>
        body {
            top: 0;
            left: 0;
            margin: 0;
            background: linear-gradient(0deg, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 36, 1) 23%, rgba(9, 9, 121, 1) 48%, rgba(0, 212, 255, 1) 100%);
            color: white;
            height: 100vh;
            font-family: 'Iosevka', monospace;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }

        canvas#life-wgpu {
            background-color: transparent;
            width: 80vh;
            height: 80vh;
        }

        canvas#life-wgpu:focus {
            outline: none;
        }

        h1 {
            font-size: 10vh;
            margin: 0;
        }

        a:link {
            color: aquamarine;
        }

        a:visited {
            color: pink;
        }

        .triangle {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-top: 50px solid rgba(0, 0, 0, 0.5);
            border-right: 50px solid rgba(0, 0, 0, 0.5);
            border-bottom: 50px solid transparent;
            border-left: 50px solid transparent;
        }

        .question-mark {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 30px;
            color: white;
            cursor: pointer;
        }

        .info-modal {
            position: absolute;
            height: 100vh;
            width: 100vw;
            top: 0;
            left: 0;
            margin: 0;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s, visibility 1s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .info-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .info-content {
            background-color: rgba(0, 0, 0, 0.7);
            font-size: 2vh;
            background-color: transparent;
            border: 3px solid white;
            padding: 40px;
            /* we want the final dimensions to be 80vh, so we account for the padding and border */
            /* 2 * padding(20px) + 2 * border(3px) = 46px */
            width: calc(80vh - 86px);
            height: calc(80vh - 86px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="main-container">
        <h1>LIFE WGPU</h1>
        <canvas id="life-wgpu"></canvas>
    </div>
    <div class="triangle"></div>
    <i class="question-mark fa-regular fa-circle-question"></i>

    <div class="info-modal">
        <h1>LIFE WGPU</h1>
        <div class="info-content">
            <p>This is an implementation of <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway's
                    Game of Life</a> running on your GPU!</p>
            <p>Controls:
                <br />R - randomise grid
                <br />P - pause/play
                <br />S - step simulation
                <br />C - clear grid
                <br />Mouse - toggle cells
            </p>
            <p>This app was built with <a href="https://wgpu.rs/">wgpu</a>, a library which allows us to create graphics
                and compute pipelines on the GPU using
                Rust code. Wgpu is able to run both natively and in the browser through <a
                    href="https://webassembly.org/">Webassembly</a> and <a
                    href="https://en.wikipedia.org/wiki/WebGPU">WebGPU</a>.</p>
            <p>WebGPU is the future of graphics on the web, with every major browser either already supporting the spec
                or <a href="https://caniuse.com/webgpu">working on an implementation</a>.</p>
            <p>Since wgpu is based on the WebGPU spec, I was able to follow this <a
                    href="https://codelabs.developers.google.com/your-first-webgpu-app">Google CodeLabs tutorial</a> to
                better understand graphics programming and use as the basis for the simulation implementation.</p>
            <p>Check out the <a href="https://github.com/Matt-Koko/life-wgpu">source code</a> on GitHub.</p>
            <p>&copy; Matt Koko 2024, MIT Licence</p>
            <p><i>In memory of John Conway (1937-2020)</i></p>
        </div>
    </div>

    <script type="module">
        async function loadWasm() {
            try {
                // Try to load wasm from wasm-server-runner first (for in-dev hot-reloading).
                const { default: init } = await import("./api/wasm.js");
                await init("/api/wasm.wasm");
                console.log("Loaded wasm from wasm-server-runner.");
            } catch (e) {
                // If wasm-server-runner fails, load wasm from local build (for prod).
                const { default: init } = await import("./pkg/life_wgpu.js");
                await init();
                console.log("Loaded wasm from package files.\nDon't mind the above 404 :)");
            }
        }

        loadWasm();

        const questionMark = document.querySelector('.question-mark');
        const infoModal = document.querySelector('.info-modal');
        const canvas = document.getElementById('life-wgpu');

        questionMark.addEventListener('click', () => {
            infoModal.classList.add('show');
        });

        infoModal.addEventListener('click', () => {
            infoModal.classList.remove('show');
        });

        // Canvas must be in focus to receive keyboard events.
        // So we keep the canvas in focus all the time.
        window.addEventListener('click', (e) => {
            canvas.focus();
        });

        window.addEventListener('keydown', (e) => {
            canvas.focus();
        });
    </script>
</body>

</html>